# -*- coding: utf-8 -*-
"""Web_Page_Analyzer.ipynb

Automatically generated by Colaboratory.
"""

!pip install anthropic beautifulsoup4 requests

from anthropic import Anthropic
from bs4 import BeautifulSoup
import requests
from IPython.display import HTML, display
from ipywidgets import widgets

def create_ui():
    # UI êµ¬ì„±ìš”ì†Œ ìƒì„±
    api_key_input = widgets.Password(
        description='API Key:',
        placeholder='Anthropic API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”',
        style={'description_width': 'initial'},
        layout={'width': '500px'}
    )

    url_input = widgets.Text(
        description='URL:',
        placeholder='ë¶„ì„í•  ì›¹í˜ì´ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”',
        style={'description_width': 'initial'},
        layout={'width': '500px'}
    )

    method_select = widgets.RadioButtons(
        options=['URL', 'Text'],
        description='ì…ë ¥ ë°©ì‹:',
        style={'description_width': 'initial'}
    )

    text_input = widgets.Textarea(
        placeholder='ì§ì ‘ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”',
        layout={'width': '500px', 'height': '200px'},
        disabled=True
    )

    output_area = widgets.Output()
    
    return api_key_input, url_input, method_select, text_input, output_area

def analyze_webpage(url):
    try:
        response = requests.get(url)
        soup = BeautifulSoup(response.text, 'html.parser')
        
        title = soup.title.string if soup.title else "ì œëª© ì—†ìŒ"
        paragraphs = soup.find_all('p')
        content = ' '.join([p.text for p in paragraphs])
        
        if len(content) > 1500:
            content = content[:1500] + "..."
            
        return title, content
    except Exception as e:
        return None, f"ì—ëŸ¬ ë°œìƒ: {str(e)}"

def summarize_text(api_key, text):
    anthropic = Anthropic(api_key=api_key)
    
    try:
        message = anthropic.messages.create(
            model="claude-3-5-sonnet-20240620",
            max_tokens=1000,
            temperature=0.7,
            messages=[{
                "role": "user",
                "content": f"ë‹¤ìŒ ì›¹ í˜ì´ì§€ ë‚´ìš©ì„ ë¶„ì„í•˜ê³  ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”:\n\n{text}"
            }]
        )
        formatted_content = format_result(message.content)
        return HTML(formatted_content)
    except Exception as e:
        return f"ìš”ì•½ ì¤‘ ì—ëŸ¬ ë°œìƒ: {str(e)}"

def format_result(content):
    return f"""
    <div style="font-family: 'Nanum Gothic', sans-serif; padding: 20px; line-height: 1.8;">
        <h1 style="text-align: center; margin-bottom: 30px;">
            ğŸ“Š ë¶„ì„ ê²°ê³¼ ğŸ“Š
        </h1>
        
        <div style="margin-bottom: 20px;">
            ğŸ¯ â˜…â˜…ë‚´ìš© ìš”ì•½ (í•µì‹¬ í¬ì¸íŠ¸ 5ê°œ):â˜…â˜…
        </div>
        
        <ol style="list-style-type: none; padding-left: 0;">
            {content}
        </ol>
    </div>
    """

def main():
    api_key_input, url_input, method_select, text_input, output_area = create_ui()
    
    def on_method_change(change):
        if change['new'] == 'Text':
            text_input.disabled = False
            url_input.disabled = True
        else:
            text_input.disabled = True
            url_input.disabled = False
    
    method_select.observe(on_method_change, names='value')
    
    def on_analyze_button_clicked(b):
        with output_area:
            output_area.clear_output()
            
            if not api_key_input.value:
                print("Anthropic API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
                return
                
            if method_select.value == 'URL':
                if not url_input.value:
                    print("URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
                    return
                    
                print("ì›¹ í˜ì´ì§€ ë¶„ì„ ì¤‘...")
                title, content = analyze_webpage(url_input.value)
                
                if title is None:
                    print(content)
                    return
            else:
                if not text_input.value:
                    print("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
                    return
                    
                title = "ì‚¬ìš©ì ì…ë ¥ í…ìŠ¤íŠ¸"
                content = text_input.value

            summary = summarize_text(api_key_input.value, content)
            display(summary)
    
    analyze_button = widgets.Button(description='ë¶„ì„ ì‹œì‘')
    analyze_button.on_click(on_analyze_button_clicked)
    
    # UI í‘œì‹œ
    display(HTML("<h2>ì›¹ í˜ì´ì§€ ë¶„ì„ ë° ìš”ì•½</h2>"))
    display(api_key_input)
    display(method_select)
    display(url_input)
    display(text_input)
    display(analyze_button)
    display(output_area)

if __name__ == "__main__":
    main()
